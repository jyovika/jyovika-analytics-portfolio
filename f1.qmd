---
title: "Do Fast Pit Stops Win F1 Races - or Is It Just Hype?"
format: html
editor: visual
---
## Introduction
In Formula One, every tenth of a second is sacred. Commentators often claim that pit stops
decide races, but how much does a second actually matter? Does an extra moment in the pit
lane truly push a driver down the finishing order, or is the fear larger than the effect?

I analysed pit-stop timing and race results across four seasons. My goal was simple.
I wanted to measure the cost of one lost second.

The results were not what I expected.

::: {.callout-note}
### Data Source
**Ergast Formula One Archive, 2011 to 2024**

CSV data retrieved from the public developer database  
<http://ergast.com/mrd/db/>

**Tools:** R, tidyverse, ggplot2, broom, boot  
**Licence:** Free for educational and non commercial projects  
More info: <http://ergast.com/mrd/terms/>
:::

## Reproducibility

This analysis can be fully reproduced using the exact datasets, code and model pipeline.
All scripts for data loading, cleaning, merging and statistical modelling are available at:

**GitHub repository:** <https://github.com/jyovika/jyovika-analytics-portfolio>

The repository contains:
• raw and cleaned data  
• code for joins and filtering  
• regression and bootstrap scripts  
• plot generation code  

You are welcome to clone or fork the project and explore or extend it further.

```{r, libraries, message=FALSE, echo=FALSE}
## Libraries
set.seed(44)
library(tidyverse)
library(broom)     
library(rsample)   
```

```{r, load_data, message=FALSE, echo=FALSE}
## Load data
pitstops_df <- read.csv(here::here("data/pit_stops.csv"))

results_df <- read.csv(here::here("data/results.csv"))

race_df <- read.csv(here::here("data/races.csv"))

driver_df <- read.csv(here::here("data/drivers.csv"))

constructor_df <- read.csv(here::here("data/constructors.csv"))

status_df <- read.csv(here::here("data/status.csv"))
```

```{r,data_processing, echo=FALSE}
## Process data
drivers_lookup <- driver_df %>%
      mutate(driver_full = paste(forename, surname)) %>%
      select(driverId, driver_full)

races_lookup <- race_df %>%
      mutate(race_full = paste(name, year)) %>%
      select(raceId, race_full, year)

constructors_lookup <- constructor_df %>%
      select(constructorId, constructor_name = name)
    
combined_df <- pitstops_df %>%
  left_join(drivers_lookup, by = "driverId") %>%
  left_join(races_lookup, by = "raceId") %>%
  left_join(
    results_df %>%
      select(raceId, driverId, constructorId, positionOrder, positionText, grid, statusId),
    by = c("raceId", "driverId")) %>%
  
  left_join(constructors_lookup, by = "constructorId") %>%
  left_join(status_df, by = "statusId") %>%
  filter(year %in% c(2011, 2015, 2019, 2024)) %>%
  select(
    driver = driver_full,
    race = race_full,
    year,
    constructor = constructor_name,
    stop,
    lap,
    duration,
    milliseconds,
    positionOrder,
    grid,
    status )

combined_2011 <- combined_df %>%
  filter(year == 2011, milliseconds <= 50000)

combined_2015 <- combined_df %>%
  filter(year == 2015, milliseconds <= 50000)

combined_2019 <- combined_df %>%
  filter(year == 2019, milliseconds <= 50000)

combined_2024 <- combined_df %>%
  filter(year == 2024, milliseconds <= 50000)
```

```{r,team_mapping, echo=FALSE}
### Team mapping 
team_map <- tribble(
  ~name, ~team,
  "Ferrari",              "Ferrari",
  "Mercedes",             "Mercedes",
  "Red Bull",             "Red Bull",
  "RB F1 Team",           "AlphaTauri/Toro Rosso/RB",
  "Toro Rosso",           "AlphaTauri/Toro Rosso/RB",
  "AlphaTauri",           "AlphaTauri/Toro Rosso/RB",
  "Williams",             "Williams",
  "McLaren",              "McLaren",
  "Lotus",                "Lotus/Renault/Alpine",
  "Lotus F1",             "Lotus/Renault/Alpine",
  "Renault",              "Lotus/Renault/Alpine",
  "Alpine F1 Team",       "Lotus/Renault/Alpine",
  "Sauber",               "Sauber/Alfa Romeo",
  "Alfa Romeo",           "Sauber/Alfa Romeo",
  "Manor Marussia",       "Manor/Marussia",
  "Marussia",             "Manor/Marussia",
  "Manor",                "Manor/Marussia",
  "HRT",                  "HRT",
  "Aston Martin",         "Racing Point/Aston Martin",
  "Racing Point",         "Racing Point/Aston Martin",
  "Haas F1 Team",         "Haas",
  "Force India",          "Force India",
  "Virgin",               "Virgin")

driver_race_df <- driver_race_df %>%
  left_join(team_map, by = c("constructor" = "name"))  %>%
  mutate(team = ifelse(is.na(team), constructor, team))
```

## Exploratory analysis
```{r}
driver_race_df <- combined_df %>%
  mutate(
    stop_sec = suppressWarnings(as.numeric(duration))) %>%
  drop_na(stop_sec) %>%      
  
  group_by(year, race, driver, constructor, grid, positionOrder) %>%
  summarise(
    best_pit_sec = min(stop_sec, na.rm = TRUE),
    avg_pit_sec  = mean(stop_sec, na.rm = TRUE),
    n_stops      = n(),
    .groups = "drop") %>%
  
  filter(best_pit_sec > 15, best_pit_sec < 60)
```

### Overall distribution (best pit per driver per race, all years):
```{r}
driver_race_df %>%
  ggplot(aes(best_pit_sec)) +
  geom_density(fill = "steelblue", alpha = 0.45) +
  labs(
    title = "Complete pit lane time distribution",
    subtitle = "Most pit cycles fall between 18 and 30 seconds",
    x = "Total pit lane time (seconds)",
    y = "Density"
  ) +
  theme_minimal()
```

Most full pit cycles range from 18 to 30 seconds. Anything above 35 seconds usually signals
damage, a hold at the release, a penalty or time lost behind cars entering or leaving the pits.

## Regression: How much does a second cost?

```{r}
model_f1 <- lm(
  positionOrder ~ best_pit_sec + grid + constructor,
  data = driver_race_df)
```

```{r, regression_table}
tidy(model_f1, conf.int = TRUE) %>%
  filter(term %in% c("best_pit_sec", "grid")) %>%
  select(term, estimate, conf.low, conf.high, p.value)
```

```{r, regression_plot}
driver_race_df %>%
  ggplot(aes(best_pit_sec, positionOrder)) +
  geom_point(alpha = 0.35, size = 1.4) +
  geom_smooth(method = "lm", se = TRUE, color = "#d62728", size = 1) +
  scale_y_reverse(expand = expansion(mult = c(0.02, 0.05))) +
  
  labs(
    title = "Slower pit stops drag drivers backwards",
    subtitle = "Relationship between total pit time and finishing position",
    x = "Total pit time (seconds)",
    y = "Finishing position (P1 at top)") +
  
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "plain"),
    panel.grid.minor = element_blank())

```

The regression shows that each extra second in the pit lane worsens finishing position by about 0.08 places on average. Slow stops therefore matter, but not in an explosive way. A delay of two or three seconds rarely destroys a race, but the effect compounds across a season.

Small losses are harmless alone. Repeated losses change outcomes. A quarter of a place here and half a place there becomes the difference between a podium and fourth, or between finishing in the points and missing out.

By comparison, grid position has a far stronger effect. Starting one place further back costs nearly half a finishing position. Pit time matters, but track position matters more.

## Bootstrapping to verify the trend

```{r bootstrap}
n_boot <- 1000
n <- nrow(driver_race_df)

boot_results <- map_dfr(1:n_boot, function(i) {
  sample_df <- driver_race_df %>% slice_sample(n = n, replace = TRUE)
  
  m <- lm(positionOrder ~ best_pit_sec + grid + constructor, data = sample_df)
  
  tibble(
    id = i,
    beta_pit = coef(m)["best_pit_sec"])
})
```

```{r bootstrap_summary}
boot_results %>%
  summarise(
    mean_est = mean(beta_pit, na.rm = TRUE),
    ci_low = quantile(beta_pit, 0.025, na.rm = TRUE),
    ci_high = quantile(beta_pit, 0.975, na.rm = TRUE)
  )
```

```{r bootstrap_plot}
boot_results %>%
  ggplot(aes(beta_pit)) +
  geom_histogram(bins = 40, fill = "dodgerblue2", alpha = 0.6, color = "white") +
  geom_vline(aes(xintercept = mean(beta_pit)), color = "red", linewidth = 1.2) +
  labs(
    title = "Bootstrap distribution of the pit-time effect",
    subtitle = "Estimated change in finishing position per additional second spent in the pit lane",
    x = "Coefficient for pit time (positions per second)",
    y = "Frequency"
  ) +
  theme_minimal()

```

Bootstrapping confirms that the effect is stable.
The average value is around 0.08, with a confidence range near 0.05 to 0.11.
Nearly every resampled model returned a positive relationship.
Slow pit stops consistently push drivers downward.

## Does the effect change over time?

```{r season_models}
season_effects <- driver_race_df %>%
  group_by(year) %>%
  do({
    m <- lm(positionOrder ~ best_pit_sec + grid, data = .)
    tibble(
      beta_pit = coef(m)["best_pit_sec"],
      beta_grid = coef(m)["grid"])
  })

season_effects
```

```{r season_plot}
season_effects %>%
  ggplot(aes(x = factor(year), y = beta_pit, group = 1)) +
  geom_area(fill = "#74add1", alpha = 0.3) +
  geom_line(color = "#1b6ca8", linewidth = 1.5) +
  geom_point(size = 4, color = "#1b6ca8", fill = "white",
             shape = 21, stroke = 1.2) +
  labs(
    title = "How costly is pit-lane time across seasons?",
    subtitle = "Coefficient = finishing positions lost per extra second in the lane",
    x = "Season",
    y = "Positions lost per second") +
  
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold", size = 16),
    panel.grid.minor = element_blank(),
    axis.title = element_text(face = "bold"),
    plot.subtitle = element_text(margin = margin(b = 10)))
  
```

In 2011, a single second was costly and often race damaging.
By 2015, the effect had softened, which reflects increased operational consistency and a wider field spread.
From 2019 onward, the influence sits around 0.10 to 0.15, small on paper but significant when margins are measured in tenths.
One second used to break a race. Today it dents it. In a tight field, even dents matter.

## Run per-constructor regression

```{r}
team_sensitivity <- driver_race_df %>%
  group_by(team) %>%
  summarise(
    correlation = cor(best_pit_sec, positionOrder, use = "complete.obs")
  ) %>%
  arrange(desc(correlation))
```

```{r}
team_sensitivity %>%
  mutate(constructor = fct_reorder(team, correlation)) %>%
  ggplot(aes(team, correlation)) +
  geom_col(fill = "#ff695e", alpha = 0.8) +
  coord_flip() +
  labs(
    title = "Which teams suffer most from slow pit stops?",
    subtitle = "Correlation between pit time and finishing position",
    x = "Constructor",
    y = "Sensitivity to pit-stop time") +
  
  theme_minimal(base_size = 13) +
  theme(
    plot.title = element_text(face = "bold"),
    axis.title.y = element_text(face = "bold"),
    panel.grid.minor = element_blank())
```
Not every team pays the same price for a slow pit stop.

Teams like Haas, Force India and HRT show a strong positive relationship between pit time and finishing position.

A slow stop usually sends them backwards because they do not have the race pace to erase the lost time. Midfield groups like Lotus/Renault/Alpine and Manor/Marussia show similar sensitivity. Their margin for error is small, so time wasted in the pit lane becomes time they never get back.

At the top end of the grid, Red Bull, Mercedes and Ferrari barely move with pit duration.
A slow stop still hurts, but their underlying pace allows them to recover. A mistake is a setback, not a race-ending blow.
